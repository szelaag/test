import { json, setCookie, signSession } from '../../_utils.mjs'; export const onRequestPost = async ({ request, env }) => { const { username, password } = await request.json().catch(()=>({})); if(!username || !password) return json({error:'Missing credentials'}, 400); const ok = username === (env.ADMIN_USER || 'admin') && password === (env.ADMIN_PASS || 'admin'); if(!ok) return json({error:'Unauthorized'}, 401); const token = await signSession({sub: username, iat: Math.floor(Date.now()/1000), exp: Math.floor(Date.now()/1000) + 60*60*8}, env.SESSION_SECRET || 'dev'); const headers = { 'Set-Cookie': setCookie('session', token, {httpOnly:true, sameSite:'Lax', path:'/', maxAge: 60*60*8, secure: true}) }; return json({ ok: true }, 200, headers); };